<html>

<head>
	<meta charset="utf-8" />
	<title>Transit Agency Extended Report</title>
	<script src="js/lib/jquery-1.9.1.min.js"></script>
	<script src="js/lib/jquery-ui.js"></script>
	<script src="js/lib/jquery-ui.multidatespicker.js"></script>
	<script src="js/lib/date.js"></script>
	<script src="js/jQueryContent.js"></script>
	
	<link rel="stylesheet" type="text/css" href="js/lib/jquery-ui.css" />
	<link rel="stylesheet" type="text/css" href="js/lib/jquery-ui.multidatespicker.css">
	<link rel="stylesheet" type="text/css" href="report.css" />
	 
<script type="text/javascript">
var csvfile ='AgencyID, AgencyName, RouteMiles, Route Stops, Stops Per Route Mile, Population Served (Unduplicated), Service Miles, Service Stops, Population Served By Service\n';
var qstring = '';
var qstringx = '0.1';
var dateID;
var gg = 1.0/1.1;
var progVal = 0; 
var html = '<table id="RT" class="sortable" align="center"><tr><th id="aid">Agency ID <em title="Identification number reported in the transit agency GTFS feed.">?</em></th>'+
'<th id="an">Agency Name <em title="Agency name reported in the transit agency GTFS feed.">?</em></th>'+
'<th>Route Miles <em title="Summation of the lengths of the longest route variant for all routes that the transit agency serves.">?</em></th>'+
'<th>Route Stops <em title="Total number of stops served by the transit agency.">?</em></th>'+
'<th>Stops Per Route Mile <em title="Route stops divided by Route Miles.">?</em></th>'+
'<th>Population Served By Route(Unduplicated) <em title="Summation of unduplicated population within an X-mile radius (i.e., stop distance) of all stops that the transit agency serves.">?</em></th>'+
'<th>Service Miles <em title="Total miles driven by a transit agency over all round trips of a route. Service miles may be calculated for a specific day of the week, a combination of days of the week (e.g., Monday and Wednesday) or for a seven day week.">?</em></th>'+
'<th>Service Stops <em title="The number of trips scheduled at a stop in a route. The service stops for a route is calculated as its stop count multiplied by the number of visits per stop.">?</em></th>'+
'<th>Population Served By Service <em title="Total unduplicated population impacted within an X-mile radius (i.e., stop distance) of all stops on trips served by the transit agency. Population served by service is calculated as service stops multiplied by the unduplicated population within an X-mile radius (i.e., stop distance) of all stops for every trip.">?</em></th></tr>';
var key = Math.random();

$(document).ready(function(){
	go(key);
	
	$.ajax({
		type: 'GET',
		datatype: 'json',
		url: '/TNAtoolAPI-Webapp/queries/transit/AgencyXR?&agency='+window.opener.qstring+'&day='+window.opener.qstringd+'&x='+ window.opener.qstringx+'&key='+ key,
		async: true,
		success: function(item){			
			$('h2').append('Transit Agency Extended Report <br><hr>');				
			html = html + '<tr><td>' + item.AgencyId +'</td><td>' + item.AgencyName +'</td><td>' + numberconv(item.RouteMiles) +'</td><td>' + numberconv(item.StopCount) +'</td><td>' + numberconv(item.StopPerRouteMile) +'</td><td>' + numberconv(item.PopServed) +'</td><td>'+numberconv(item.ServiceMiles)+'</td><td>'+ numberconv(item.ServiceStops) +'</td><td>'+numberconv(item.PopServedByService)+'</td></tr>';
			csvfile = csvfile +item.AgencyId+', '+item.AgencyName+', '+ item.RouteMiles +', '+item.StopCount+', '+item.StopPerRouteMile+', '+item.PopServed+', '+item.ServiceMiles+', '+item.ServiceStops+', '+item.PopServedByService+' \n';						    
			html = html + '</table>'
			$('#displayReport').append($(html));	
			progressbar.remove();
    }});
	
	$('a').click(function(e){
	    if ($(this).attr('type')=="RC"){
	    	qstring = $(this).attr('id');
	    	qstringx = '0.1';
	    	window.open('/TNA-tool-NI/routereport.html');
	    	}else if($(this).attr('type')=="SC"){
	    		qstring = $(this).attr('id');
	    		qstringx = '0.1';
	    		window.open('/TNA-tool-NI/stopreport.html');	    		
	    	};    
	});
});



</script>
</head>
<body>
		<div class="container">
			<div class="headerL">
				<h1>Transit Network Analysis Tool Reports</h1>
			</div>
			
			<div class="headerR">
				<input type="button" onclick="exportbutton()" title="Export Report"  value="Export Report" class="button" />
				<input type="button" onclick="printbutton()" title="Print Report"  value="Print Report" class="button" />
				<input type="button" onclick="closebutton()" title="Close Report"  value="Close Report" class="button" />
			</div>
		</div>	
		
		<table id="controls">
			<tr>
			  <td id="td1">
			  	<div class="headerBL"  >
				<h2 style="margin:0px;"></h2>
				</div>
			  </td>
			  <td id="td2"> 
			  	<div class="headerBC" id="accordion" >
					<h3></h3>
					<div>
						<table style="width:100%;">
							<tr>
								<td id="accordionItems" style="padding-left:10px;vertical-align:top">
									<ul data-role="listview">
							
									</ul>
								</td>
								<td style="vertical-align:top;padding-top:15px">
									<div id="datepicker" ></div>
								</td>
							</tr>
						</table>
						
					</div>
				</div>
			  </td> 
			  <td id="td3">
			  	<div class="headerBR" > 
			    	Population Search Radius (miles) <input type="text" name="Sradius" id="Sradius" class="tbox" onkeypress="return isNumber(event)"/>
			    	<input type="button" onclick="reload()" title="Refresh Report"  value="Submit" class="button" />
		    	    	
		    	</div>
			  </td>
			</tr>
		</table>
		
		<p id="displayReport"><br></p>
		<br>
		<br>
		<div id="progressbar" style="width:40%;margin-left:27%"><div class="progress-label"></div></div>

</body>
</html>